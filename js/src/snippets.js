var close=document.querySelector("#close"),sclose=document.querySelector(".search-close"),codePreview=document.querySelector("#codePreview"),codeTypes=document.querySelector("#codeTypes"),codebox=document.querySelector("#codebox"),codectt=document.querySelector("#codectt"),typeList=document.querySelector("#typeList"),code=document.querySelector("#code"),progress=document.querySelector("#progress"),q=document.querySelector("#q"),qinfo=document.querySelector(".search-info"),addSnippet=document.querySelector(".add-snippet"),Snippet={cache:{},init:function(){this.storeData(),this.bind(),this.duoshuo(),this.tongji()},storeData:function(){for(var e={},t=0;t<snippets.length;t++)e[snippets[t].type]?e[snippets[t].type].push(snippets[t]):e[snippets[t].type]=[snippets[t]];this.store=e,this.initNav()},initNav:function(){var e,t="<ul>",o=!0;for(var r in this.store)t+="<li"+(o?" class='on'":"")+"><span data-type="+r+">"+r+"</span></li>",o&&(o=!1,e=r);t+="</ul>",codeTypes.innerHTML=t,this.renderList(e)},bind:function(){var e=this;codeTypes.addEventListener("click",function(t){if("span"==t.target.nodeName.toLowerCase()){var o=t.target.parentNode;if("on"==o.getAttribute("class"))return;for(var r=o.parentNode.getElementsByTagName("li"),s=0;s<r.length;s++)r[s].hasAttribute("class")&&r[s].removeAttribute("class");o.setAttribute("class","on"),e.renderList(t.target.textContent),window.location.hash="#!/snippets/"+t.target.getAttribute("data-type"),close.click()}}),typeList.addEventListener("click",function(t){if(t.preventDefault(),"a"==t.target.nodeName.toLowerCase()){for(var o=t.target.parentNode.parentNode.getElementsByTagName("a"),r=0;r<o.length;r++)o[r].hasAttribute("class")&&o[r].removeAttribute("class");t.target.setAttribute("class","on"),codePreview.setAttribute("class","codePreview on");var s=t.target.getAttribute("data-url"),n=t.target.textContent;e.showCode(s,n),window.location.hash="#!"+s;var i=codebox.getAttribute("data-baseurl");document.querySelector(".codebox .pen").setAttribute("href",(i+s).replace(/\/$/,".md"))}}),codebox.addEventListener("click",function(e){"close"==e.target.getAttribute("id")&&close.click()}),close.addEventListener("click",function(){codePreview.setAttribute("class","codePreview")}),sclose.addEventListener("click",function(){document.onkeydown({keyCode:27}),document.querySelector("body").removeAttribute("class"),q.value="",qinfo.style.opacity=0;var t=document.querySelector(".codeTypes li.on span").textContent.toLowerCase();e.renderList(t)}),addSnippet.addEventListener("click",function(e){return void window.open("https://github.com/barretlee/snippets/issues/new")}),q.onkeypress=q.onkeyup=q.onkeydown=q.onfocus=function(t){var o=q.value;if(!o)return void(qinfo.style.opacity=0);if(27!=t.keyCode){document.querySelector("body").setAttribute("class","search_on"),close.click();for(var r=[],s=0;s<snippets.length;s++)snippets[s].title.indexOf(o)>-1&&r.push(snippets[s]);qinfo.style.opacity=1,r.length?qinfo.textContent="找到了"+r.length+"个结果，按 Enter 键展示。":qinfo.textContent="没有找到相关内容~",13==t.keyCode&&(close.click(),e.renderList("SEARCH",r))}},document.onkeydown=function(e){var t=document.querySelector("body");27==e.keyCode&&(t.hasAttribute("class")&&t.removeAttribute("class"),close.click())},window.onhashchange=window.onload=function(){var e=window.location.hash;if(e){var t=e.slice(2);if(e=e.split("/"),"snippets"==e[1]&&e[2]){var o=document.querySelector('span[data-type="'+e[2]+'"]');o&&setTimeout(function(){o.click()},200),e[3]&&setTimeout(function(){var e=document.querySelector('a[data-url="'+t+'"]');e&&e.click()},300)}}}},renderList:function(e,t){var o=t||Snippet.store[e.toLowerCase()]||{},r="<ul>";"SEARCH"==e&&(r+="<li class='search-ret'>搜索结果</li>"),o&&!o.length&&(r+="<li class='search-null'>没有找到相关的 snippet，你可以帮助添加哦~</li>");for(var s=0;s<o.length;s++)r+="<li"+(s%2?' class="odd"':"")+'><a href="javascript:void(0);" data-url="'+o[s].url+'">'+o[s].title+(t?" <span>( "+o[s].type+" )</span>":"")+"</a></li>";r+="</ul>",typeList.innerHTML=r},showCode:function(url,title){var self=this,oldUrl=codebox.getAttribute("data-url");if(oldUrl!=url)if(codebox.setAttribute("data-url",url),codebox.setAttribute("data-title",title),self.cache[url]){codectt.innerHTML=self.cache[url];for(var codes=codectt.querySelectorAll(".code pre"),i=0;i<codes.length;i++)hljs.highlightBlock(codes[i])}else with(self.updateProgress(Math.floor(20*Math.random())+10),new XMLHttpRequest)open("GET",url+"?_t="+1*new Date),onreadystatechange=function(){if(4==readyState){self.updateProgress(Math.floor(30*Math.random())+40),self.cache[url]="<h2>"+title+"</h2>"+responseText,codectt.innerHTML=self.cache[url];for(var e=codectt.querySelectorAll(".code pre"),t=0;t<e.length;t++)hljs.highlightBlock(e[t]);self.updateProgress(Math.floor(20*Math.random())+80)}},send()},updateProgress:function(e){progress.getElementsByTagName("div")[0].style.width=e+"%",e>=80?(progress.getElementsByTagName("div")[0].style.width="100%",this.timer&&clearTimeout(this.timer),setTimeout(function(){progress.style.opacity="0",progress.getElementsByTagName("div")[0].style.width=0},100)):progress.style.opacity="1"},tongji:function(){!function(){var e=document.createElement("script");e.src="//hm.baidu.com/hm.js?58aefbf3de3372645a3e8796d7601fee";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()},duoshuo:function(){window.duoshuoQuery={short_name:"barretlee"},function(){var e=document.createElement("script");e.type="text/javascript",e.async=!0,e.src="http://static.duoshuo.com/embed.js",e.charset="UTF-8",(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(e)}()}};Snippet.init();